# Политика безопасности

## Обнаруженные и исправленные уязвимости

### ✅ Исправлено

1. **Захардкоженные API ключи и пароли**
   - Удалены все скрипты с захардкоженными секретами
   - Создан шаблон `deploy-with-proxy.sh.template` для безопасного развертывания
   - Все секреты теперь только в переменных окружения

2. **Небезопасный CORS**
   - Ограничен CORS только разрешенными доменами
   - Настраивается через переменную окружения `ALLOWED_ORIGINS`
   - По умолчанию только локальные домены для разработки

3. **Отсутствие rate limiting**
   - Добавлен rate limiting: 30 запросов за 15 минут на IP
   - Защита от DDoS и злоупотреблений

4. **Недостаточная валидация**
   - Добавлена валидация размера изображений (макс 5MB)
   - Валидация форматов изображений (только JPEG, PNG, WebP)
   - Валидация длины промпта (10-5000 символов)

5. **Раскрытие информации в логах**
   - Логирование очищено от секретов
   - Детали ошибок не раскрываются клиенту
   - Безопасное логирование с санитизацией данных

6. **Отсутствие ограничений размера запросов**
   - Уменьшен лимит запросов с 50MB до 10MB

## Конфигурация безопасности

### Переменные окружения

```bash
# Обязательные
GEMINI_API_KEY=your_api_key_here

# Опциональные
ALLOWED_ORIGINS=http://localhost:3000,http://yourdomain.com
PORT=3001
```

### Настройка CORS

Для продакшена установите `ALLOWED_ORIGINS` в docker-compose.yml:

```yaml
environment:
  - ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
```

## Инструкции по безопасному развертыванию

1. **Никогда не коммитьте секреты в git**
   - Используйте `.env` файлы (они в .gitignore)
   - Используйте переменные окружения Docker
   - Используйте секреты CI/CD систем

2. **Создание скрипта развертывания**
   ```bash
   cp deploy-with-proxy.sh.template deploy-with-proxy.sh
   # Отредактируйте deploy-with-proxy.sh, заполнив переменные
   chmod +x deploy-with-proxy.sh
   ```

3. **Настройка сервера**
   - Используйте SSH ключи вместо паролей
   - Настройте firewall
   - Регулярно обновляйте зависимости

4. **Мониторинг**
   - Проверяйте логи на подозрительную активность
   - Мониторьте использование API ключа
   - Отслеживайте rate limit нарушения

## Ограничения безопасности

- Rate limiting: 30 запросов за 15 минут на IP
- Максимальный размер изображения: 5MB
- Максимальный размер промпта: 5000 символов
- Разрешенные форматы: JPEG, PNG, WebP

## Контакты для сообщений об уязвимостях

Если вы обнаружили уязвимость, пожалуйста, сообщите о ней через Issues GitHub.

